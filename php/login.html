<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logemangue - Connexion/Inscription</title>
    <link href="../css/style.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: linear-gradient(135deg, #ffd700, #ffa500);
      }

      .content-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: calc(100vh - 80px);
        padding: 20px;
      }

      .container {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 30px;
        width: 100%;
        max-width: 400px;
        text-align: center;
      }

      .logo {
        color: #f5a623;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        font-size: 14px;
        margin-bottom: 20px;
      }

      .tabs {
        display: flex;
        margin-bottom: 20px;
      }

      .tab {
        flex: 1;
        padding: 10px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        color: #666;
        font-weight: 500;
      }

      .tab.active {
        color: #F5A623;
        border-bottom-color: #F5A623;
      }

      .form-group {
        margin-bottom: 15px;
        text-align: left;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 14px;
        color: #666;
      }

      .form-group input,
      .form-group select {
        padding: 12px 15px;        
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #ffa500;
        box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
      }

      .form-select {
        background-color: white;
        cursor: pointer;
      }

      .btn {
        background-color: #f5a623;
        color: white;
        border: none;
        padding: 12px;
        width: 100%;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: 0.3s ease;
      }

      .btn:hover {
        background-color: #ff8c00;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .link {
        color: #F5A623;
        text-decoration: none;
        font-size: 14px;
      }

      .link:hover {
        text-decoration: underline;
      }

      .email-status {
        display: block;
        margin-top: 6px;
        font-size: 14px;
      }

      .email-status.success {
        color: #2ecc71;
      }

      .email-status.error {
        color: #e74c3c;
      }

      .email-status.loading {
        color: #999;
        font-style: italic;
      }

      /* CALENDRIER PERSONNALISÉ */
      .calendar-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .calendar-modal.active {
        display: flex;
      }

      .calendar-container {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .calendar-header {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 3px solid;
        border-image: linear-gradient(90deg, #ffd700, #ffa500) 1;
      }

      .calendar-month-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .calendar-title {
        font-size: 20px;
        font-weight: bold;
        background: linear-gradient(135deg, #ffd700, #ffa500);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .calendar-nav {
        display: flex;
        gap: 10px;
      }

      .calendar-year-nav {
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: center;
      }

      .year-selector {
        padding: 8px 15px;
        border: 2px solid #ffa500;
        border-radius: 8px;
        background: white;
        font-size: 16px;
        font-weight: 600;
        color: #333;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .year-selector:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.2);
      }

      .year-btn {
        width: 35px;
        height: 35px;
        border: none;
        border-radius: 50%;
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: white;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(255, 165, 0, 0.3);
      }

      .year-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 165, 0, 0.4);
      }

      .nav-btn {
        width: 35px;
        height: 35px;
        border: none;
        border-radius: 50%;
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: white;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(255, 165, 0, 0.3);
      }

      .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 165, 0, 0.4);
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
        margin-bottom: 10px;
      }

      .day-header {
        text-align: center;
        font-weight: 600;
        color: #666;
        padding: 8px 0;
        font-size: 12px;
      }

      #calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
        grid-column: 1 / -1;
      }

      .day-cell {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 14px;
      }

      .day-cell:hover:not(.empty):not(.disabled) {
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: white;
        transform: scale(1.1);
      }

      .day-cell.today {
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
      }

      .day-cell.selected {
        background: linear-gradient(135deg, #ff8c00, #ff6b00);
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(255, 108, 0, 0.5);
      }

      .day-cell.empty {
        cursor: default;
        color: #ccc;
      }

      .day-cell.disabled {
        cursor: not-allowed;
        color: #ddd;
        background: #f5f5f5;
      }

      .calendar-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .calendar-btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .calendar-btn.validate {
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: white;
      }

      .calendar-btn.validate:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
      }

      .calendar-btn.cancel {
        background: #f0f0f0;
        color: #666;
      }

      .calendar-btn.cancel:hover {
        background: #e0e0e0;
      }

      .age-warning {
        background: linear-gradient(135deg, #fff5e6, #ffe6cc);
        border-left: 4px solid #ffa500;
        padding: 12px;
        border-radius: 6px;
        margin-top: 15px;
        font-size: 13px;
        color: #666;
        text-align: left;
      }

      .age-error {
        background: #ffe6e6;
        border-left: 4px solid #e74c3c;
        padding: 12px;
        border-radius: 6px;
        margin-top: 15px;
        font-size: 13px;
        color: #c0392b;
        text-align: left;
        display: none;
      }

      .age-error.show {
        display: block;
      }

      .birthdate-input-wrapper {
        position: relative;
      }

      .birthdate-input-wrapper input {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
  <header class="topbar">
    <a href="index" class="topbar-logo">
      <img src="../png/topbar.png" onresize="3000" alt="Logo" />
    </a>
  <div class="burger-menu">
    <span></span>
    <span></span>
    <span></span>
  </div>
    <nav class="topbar-nav">
      <a class="nav-link " href="index">Accueil</a>
      <a class="nav-link" href="logements">Recherche</a>
      <a class="nav-link" href="publish">Publier une annonce</a>
      <a class="nav-link" href="listemessagerie">Ma messagerie</a>
      <a class="nav-link " href="profil.php">Mon profil</a>
    </nav>
  </header>

    <div class="content-wrapper">
      <div class="container">
        <a href="index" class="topbar-logo">
          <img src="../png/topbar.png" onresize="3000" alt="Logo" />
        </a>        

        <div class="tabs">
          <div class="tab active" id="login-tab">Connexion</div>
          <div class="tab" id="register-tab">Créer un compte</div>
        </div>

        <!-- Formulaire de connexion -->
        <div id="msg-erreur" style="display:none; color:red;">
            <strong>Erreur :</strong> Les identifiants sont incorrects. Veuillez réessayer.
        </div>  
        <div id="msg-erreur-email" style="display:none; color:red;">
            <strong>Erreur :</strong> Votre compte n'a pas été vérifié. Veuillez vérifier votre email.
        </div>       
        <div id="msg-erreur-car" style="display:none; color:red;">
            <strong>Erreur :</strong> Vous avez utilisé des caractères non autorisés.
        </div>         
        <div id="msg-email-valide" style="display:none; color:green;">
            <strong>Succès :</strong> Votre compte a bien été validé. Vous pouvez maintenant vous connecter.
        </div>
        <form id="login-form" action="login.php" method="post">
          <div class="form-group">
            <label for="login-email">Adresse email</label>
            <input type="email" id="login-email" name="email" required />
          </div>
          <div class="form-group">
            <label for="login-password">Mot de passe</label>
            <input type="password" id="login-password" name="password" required />
          </div>
          <div class="form-group">
            <a href="forgot_password" class="link">Mot de passe oublié ?</a>
          </div>
          <button type="submit" class="btn">Se connecter</button>
        </form>

        <!-- Formulaire d'inscription -->
        <form id="register-form" action="register.php" method="post" style="display: none">
          <div class="form-group">
            <label for="register-email">Adresse email</label>
            <input type="email" id="register-email" name="email" required />
            <span id="email-status"></span>
          </div>
          <div class="form-group">
            <label for="register-password">Mot de passe</label>
            <input type="password" id="register-password" name="password" required />
          </div>
          <div class="form-group">
            <label for="register-confirm-password">Confirmer le mot de passe</label>
            <input type="password" id="register-confirm-password" name="confirm_password" required />
          </div>
          <div class="form-group">
            <label for="register-name">Nom complet</label>
            <input type="text" id="register-name" name="name" required />
          </div>
          <div class="form-group">
            <label for="register-phone">Numéro de téléphone</label>
            <input type="tel" id="register-phone" name="phone" required />
          </div>  
          <div class="form-group">
            <label for="register-birthdate">Date de naissance (minimum 16 ans)</label>
            <div class="birthdate-input-wrapper">
              <input type="text" id="register-birthdate" name="birthdate" placeholder="Cliquez pour choisir une date" readonly required />
              <input type="hidden" id="birthdate-hidden" name="birthdate_value" />
            </div>
          </div>         
          <div class="form-group">
            <label for="register-type">Type d'utilisateur</label>
            <select class="form-select" id="register-type" name="type_utilisateur" required>
              <option value="" disabled selected>Choisir le type d'utilisateur</option>
              <option value="Etudiant">Étudiant</option>
              <option value="Proprietaire">Propriétaire</option>
            </select>
          </div>         
          <div class="form-group">
            <label for="genre">Genre</label>
            <select class="form-select" id="genre" name="genre" required>
              <option value="" disabled selected>Choisir votre genre</option>
              <option value="Homme">Homme</option>
              <option value="Femme">Femme</option>
              <option value="Autre">Autre</option>
            </select>
          </div>         
          <button type="submit" class="btn">S'inscrire</button>
        </form>
        
        <a href="logements" class="link">→ Je veux simplement voir les logements</a>
      </div>
    </div>

    <!-- CALENDRIER MODAL -->
    <div class="calendar-modal" id="calendar-modal">
      <div class="calendar-container">
        <div class="calendar-header">
          <div class="calendar-month-nav">
            <h2 class="calendar-title" id="monthYear"></h2>
            <div class="calendar-nav">
              <button type="button" class="nav-btn" onclick="changeMonth(-1)">‹</button>
              <button type="button" class="nav-btn" onclick="changeMonth(1)">›</button>
            </div>
          </div>
          
          <div class="calendar-year-nav">
            <button type="button" class="year-btn" onclick="changeYear(-1)">-</button>
            <select class="year-selector" id="year-selector" onchange="changeToYear()"></select>
            <button type="button" class="year-btn" onclick="changeYear(1)">+</button>
          </div>
        </div>
        
        <div class="calendar-grid">
          <div class="day-header">Lun</div>
          <div class="day-header">Mar</div>
          <div class="day-header">Mer</div>
          <div class="day-header">Jeu</div>
          <div class="day-header">Ven</div>
          <div class="day-header">Sam</div>
          <div class="day-header">Dim</div>
        </div>
        
        <div id="calendar-days"></div>

        <div class="age-warning">
          ℹ️ Vous devez avoir au moins 16 ans pour vous inscrire
        </div>

        <div class="age-error" id="age-error">
          ❌ Cette date correspond à moins de 16 ans. Veuillez choisir une date antérieure.
        </div>
        
        <div class="calendar-actions">
          <button type="button" class="calendar-btn cancel" onclick="closeCalendar()">Annuler</button>
          <button type="button" class="calendar-btn validate" onclick="validateDate()">Valider</button>
        </div>
      </div>
    </div>

    <script>
  const params = new URLSearchParams(window.location.search);

  if (params.get('erreur') === '1') {
    document.getElementById('msg-erreur').style.display = 'block';
  }
    if (params.get('error') === 'carun') {
    document.getElementById('msg-erreur-car').style.display = 'block';
  }
    if (params.get('erreur') === '2') {
    document.getElementById('msg-erreur-email').style.display = 'block';
  }
   if (params.get('verified') === '1') {
    document.getElementById('msg-email-valide').style.display = 'block';
  }
</script>
    <script>
      const loginTab = document.getElementById("login-tab");
      const registerTab = document.getElementById("register-tab");
      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");

        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.style.display = 'block';
            loginForm.style.display = 'none';
        });
    </script>
    <script>
const emailInput = document.getElementById('register-email');
const status = document.getElementById('email-status');

let timeout = null;

emailInput.addEventListener('input', () => {
    clearTimeout(timeout);

    timeout = setTimeout(() => {
        const email = emailInput.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!email) {
            status.textContent = '';
            status.className = 'email-status';
            return;
        }

        if (!emailRegex.test(email)) {
            status.textContent = '❌ Format email invalide';
            status.className = 'email-status error';
            return;
        }

        status.textContent = 'Vérification...';
        status.className = 'email-status loading';

        fetch('check_email.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        })
        .then(res => res.json())
        .then(data => {
            if (data.exists) {
                status.textContent = '❌ Email déjà utilisé';
                status.className = 'email-status error';
            } else {
                status.textContent = '✅ Email disponible';
                status.className = 'email-status success';
            }
        });
    }, 500);
});
</script>
    <script>
      let currentDate = new Date();
      let selectedDate = null;
      const months = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];

      const today = new Date();
      const maxDate = new Date(today.getFullYear() - 16, today.getMonth(), today.getDate());

      document.getElementById('register-birthdate').addEventListener('click', function() {
        document.getElementById('calendar-modal').classList.add('active');
        populateYearSelector();
        renderCalendar();
      });

      function populateYearSelector() {
        const yearSelector = document.getElementById('year-selector');
        yearSelector.innerHTML = '';
        
        const currentYear = new Date().getFullYear();
        const startYear = currentYear - 100;
        const endYear = currentYear - 16;
        
        for (let year = endYear; year >= startYear; year--) {
          const option = document.createElement('option');
          option.value = year;
          option.textContent = year;
          if (year === currentDate.getFullYear()) {
            option.selected = true;
          }
          yearSelector.appendChild(option);
        }
      }

      function changeYear(increment) {
        currentDate.setFullYear(currentDate.getFullYear() + increment);
        document.getElementById('year-selector').value = currentDate.getFullYear();
        renderCalendar();
      }

      function changeToYear() {
        const selectedYear = parseInt(document.getElementById('year-selector').value);
        currentDate.setFullYear(selectedYear);
        renderCalendar();
      }

      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        document.getElementById('monthYear').textContent = `${months[month]} ${year}`;
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = (firstDay.getDay() + 6) % 7;
        
        const calendarDays = document.getElementById('calendar-days');
        calendarDays.innerHTML = '';
        
        for (let i = 0; i < startingDayOfWeek; i++) {
          const emptyCell = document.createElement('div');
          emptyCell.className = 'day-cell empty';
          calendarDays.appendChild(emptyCell);
        }
        
        for (let day = 1; day <= daysInMonth; day++) {
          const dayCell = document.createElement('div');
          dayCell.className = 'day-cell';
          dayCell.textContent = day;
          
          const cellDate = new Date(year, month, day);
          
          //désactiver dates > 16
          if (cellDate > maxDate) {
            dayCell.classList.add('disabled');
          } else {
            if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
              dayCell.classList.add('today');
            }
            
            dayCell.onclick = () => selectDate(day, month, year, dayCell, cellDate);
          }
          
          calendarDays.appendChild(dayCell);
        }
      }

      function selectDate(day, month, year, element, cellDate) {
        if (cellDate > maxDate) {
          document.getElementById('age-error').classList.add('show');
          return;
        }
        
        document.getElementById('age-error').classList.remove('show');
        
        document.querySelectorAll('.day-cell.selected').forEach(cell => {
          cell.classList.remove('selected');
        });
        
        element.classList.add('selected');
        selectedDate = new Date(year, month, day);
      }

      function changeMonth(increment) {
        currentDate.setMonth(currentDate.getMonth() + increment);
        renderCalendar();
      }

      function validateDate() {
        if (!selectedDate) {
          alert('Veuillez sélectionner une date');
          return;
        }
        
        if (selectedDate > maxDate) {
          document.getElementById('age-error').classList.add('show');
          return;
        }
        
        const day = String(selectedDate.getDate()).padStart(2, '0');
        const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
        const year = selectedDate.getFullYear();
        
        const formattedDate = `${day}/${month}/${year}`;
        const isoDate = `${year}-${month}-${day}`;
        
        document.getElementById('register-birthdate').value = formattedDate;
        document.getElementById('birthdate-hidden').value = isoDate;
        
        closeCalendar();
      }

      function closeCalendar() {
        document.getElementById('calendar-modal').classList.remove('active');
        selectedDate = null;
      }

      // Fermer en cliquant en dehors
      document.getElementById('calendar-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeCalendar();
        }
      });
    </script>

<script src="../js/responsive.js"> </script>
  </body>
  <footer style="text-align: center; padding: 20px; margin-top: 20px;">
    <a class="link text-muted" href="index?page=faq">FAQ</a>
    <a class="link text-muted" href="index?page=cgu">CGU</a> <br>
      Logemangue - Tous droits réservés
<br />
</footer>

</html>